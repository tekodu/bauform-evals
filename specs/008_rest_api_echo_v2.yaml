spec:
  id: "008"
  name: "REST API Echo Service"
  version: "2.0"
  category: "api_integration"
  
  description: |
    Simple REST API that echoes back request details: headers, body, method, path.
    Useful for API testing and debugging. Must handle various content types and
    include security headers in responses.
  
  functional_requirements:
    - "Echo back HTTP method, path, headers, body"
    - "Support GET, POST, PUT, DELETE methods"
    - "Handle JSON, form data, plain text"
    - "Include request metadata (timestamp, IP, user-agent)"
    - "Return well-formed JSON response"
  
  security_requirements:
    - "Add security headers (HSTS, X-Content-Type-Options, etc.)"
    - "Sanitize echoed headers (remove auth tokens)"
    - "Prevent SSRF through body reflection"
    - "Rate limit requests"
  
  constraints:
    max_body_bytes: 10485760  # 10MB
    timeout_seconds: 30
    max_memory_mb: 256
  
  performance_targets:
    p50_latency_ms: 30
    p95_latency_ms: 500
    p99_latency_ms: 1000
    throughput_rps: 100
    cold_start_ms: 1000
  
  test_scenarios:
    golden_cases:
      - name: "get_request"
        method: "GET"
        path: "/test?param=value"
        expected_output:
          method: "GET"
          path: "/test"
          query: {param: "value"}
      
      - name: "post_json"
        method: "POST"
        path: "/echo"
        body: '{"message": "hello"}'
        content_type: "application/json"
        expected_output:
          method: "POST"
          body: {message: "hello"}
          content_type: "application/json"
      
      - name: "custom_headers"
        method: "GET"
        headers:
          X-Custom: "test-value"
        expected_output:
          headers:
            X-Custom: "test-value"
    
    adversarial_cases:
      - name: "auth_header_not_echoed"
        headers:
          Authorization: "Bearer secret_token"
        expected_behavior: "Don't echo Authorization header"
      
      - name: "huge_body"
        body_size_mb: 15
        expected_behavior: "Reject with 413"
    
    limit_enforcement:
      - name: "oversized_body"
        body_size_mb: 15
        expected_response: "413 Payload Too Large"
  
  validation_gates:
    functional:
      - all_methods_supported
      - accurate_echo
      - metadata_included
      - content_types_handled
    
    security:
      - security_headers_present
      - sensitive_headers_redacted
      - no_ssrf_vulnerability
    
    limits:
      - body_size_enforced
      - rate_limiting
    
    performance:
      - p95_latency_under_500ms
      - high_throughput
      - minimal_processing_overhead
    
    stability:
      - no_memory_leaks
      - handles_malformed_requests
  
  deployment:
    runtime: "python3.11+"
    interface: "REST API (any method /echo)"
    dependencies:
      - "FastAPI, Flask, or similar"

